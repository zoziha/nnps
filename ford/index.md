---
title: User Guide
---

[TOC]

# 用户指南

该资源库包含使用以下方法进行近邻粒子搜索的源代码：

* 直接搜索 \(O(n^2/2)\)；
* kD数型搜索 \(O(nlogn)\)；
* 背景网格搜索 \(O(n)\)。

用于优化目的：由于在 NNPS 中会涉及到距离求解、
而在 CFD 粒子法的其他求解过程中也需要距离求解、
为了减少计算量，求解得到的距离将存储在这个仓库的数据结构中。
为了减少计算量，求解得到的距离将存储在本仓库的数据结构中，以尽可能提高效率。
存储的距离包括线距和线距的轴分量。

* `pairs`: `[i, j]`；
* `rdxs`: `[r, dx(dim)], dx = xi - xj`。

@note
直接搜索法相对简单，因为它不需要构建数据结构；
树搜索法由于单粒子搜索的计算量较大，因此总耗时可能较长；
而背景网格法的时间复杂度较低，而且如果重复使用背景网格，计算量也相对较小。

为了改善缓存读写，空间哈希与 Z 排序或其他图排序相结合，以获得紧凑的哈希值、
本资源库暂不考虑。

## 并行加速

`NNPS` 支持 OpenMP 并行加速，任务有：

* [ ] NNPS 构建；
* [x] NNPS 搜索。

对于 2D/3D NNPS，OpenMP 用于并行加速，并行线程可通过 `OMP_NUM_THREADS` 环境变量设置。
OpenMP 加速的原理是每个线程维护一个粒子对列表 `threads_pairs`，在粒子对的并行搜索完成后，将它们统一合并。

## 链接

- [SPH教程](https://sph-tutorial.physics-simulation.org/)。
